!function i(u,a,c){function s(e,n){if(!a[e]){if(!u[e]){var t="function"==typeof require&&require;if(!n&&t)return t(e,!0);if(f)return f(e,!0);var r=new Error("Cannot find module '"+e+"'");throw r.code="MODULE_NOT_FOUND",r}var o=a[e]={exports:{}};u[e][0].call(o.exports,function(n){return s(u[e][1][n]||n)},o,o.exports,i,u,a,c)}return a[e].exports}for(var f="function"==typeof require&&require,n=0;n<c.length;n++)s(c[n]);return s}({1:[function(n,e,t){"use strict";e.exports=function(i){var n,u=(n=1,function(){return n+=1}),a=new URL(i.getAttribute("src")).origin,c={},t=function(){};return window.addEventListener("message",function(n){if(n.origin===a){if(!n.data||!n.data.uid)return n.data.event?t(n.data):void 0;var e=c[n.data.uid];e&&(delete c[n.data.uid],e(n.data.error,n.data.data))}}),{call:function(n,e,t){var r=u(),o={uid:r,method:n,options:e};c[r]=t,i.contentWindow.postMessage(o,a)},listen:function(n){t=n}}}},{}],2:[function(n,e,t){"use strict";var i=n("@tryghost/members-layer0"),u=n("minivents");function a(e){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return function(n){return new Promise(function(t,r){n.call(e,o,function(n,e){n&&r(n),t(e)})})}}e.exports=function(n){var r={getToken:function(n){var e=n.audience,t=n.fresh;return o.then(a("getToken",{audience:e,fresh:t}))},getConfig:function(){return o.then(a("getConfig"))},signout:function(){return o.then(a("signout"))},signin:function(n){var e=n.email,t=n.password;return o.then(a("signin",{email:e,password:t}))},signup:function(n){var e=n.name,t=n.email,r=n.password;return o.then(a("signin",{name:e,email:t,password:r}))},requestPasswordReset:function(n){var e=n.email;return o.then(a("request-password-reset",{email:e}))},resetPassword:function(n){var e=n.token,t=n.password;return o.then(a("reset-password",{token:e,password:t}))},verifyEmail:function(n){var e=n.token;return o.then(a("verify-email",{token:e}))},bus:new u},o=function(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.body;return new Promise(function(n){var e=document.createElement("iframe");e.style.display="none",e.src=t,e.onload=function(){n(e)},r.appendChild(e)})}(n.gatewayUrl,n.container).then(function(n){var e=i(n),t=a("init");return e.listen(function(n){r.bus.emit(n.event,n.payload)}),t(e).then(function(){return e})});return r}},{"@tryghost/members-layer0":1,minivents:5}],3:[function(n,e,t){"use strict";var a=n("@tryghost/members-layer1");e.exports=function(n){var o="".concat(n.membersUrl,"/auth"),e="".concat(n.membersUrl,"/gateway"),t=n.container,r=a({gatewayUrl:e,container:t}),i=function(t){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.body;return new Promise(function(n){var e=document.createElement("iframe");e.style.display="none",e.src=t,e.onload=function(){n(e)},r.appendChild(e)})}(o,t).then(function(n){return n.style.position="fixed",n.style.width="100%",n.style.height="100%",n.style.background="transparent",n.style.top="0",n.style["z-index"]="9999",n});function u(n){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"";return i.then(function(r){return new Promise(function(t){r.src="".concat(o,"#").concat(n,"?").concat(e),r.style.display="block",window.addEventListener("message",function n(e){e.source===r.contentWindow&&e.data&&"pls-close-auth-popup"===e.data.msg&&(window.removeEventListener("message",n),r.style.display="none",t(!!e.data.success))})})})}return Object.assign(r.bus,{getToken:function(n){var e=n.audience,t=n.fresh;return r.getToken({audience:e,fresh:t})},getSSRToken:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).fresh;return r.getConfig().then(function(n){var e=n.issuer;return r.getToken({audience:e,fresh:t})})},signout:function(){return r.signout()},signin:function(){return u("signin")},signup:function(){var n=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).coupon;return u("signup","coupon=".concat(n))},upgrade:function(){return u("upgrade")},resetPassword:function(n){var e=n.token;return u("reset-password","token=".concat(e))}})}},{"@tryghost/members-layer1":2}],4:[function(n,t,e){"use strict";function r(n){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}!function(n,e){void 0!==t?t.exports=e():"function"==typeof define&&"object"==r(define.amd)?define(e):this.domready=e()}(0,function(){var n,e=[],t=document,r=t.documentElement.doScroll,o="DOMContentLoaded",i=(r?/^loaded|^c/:/^loaded|^i|^c/).test(t.readyState);return i||t.addEventListener(o,n=function(){for(t.removeEventListener(o,n),i=1;n=e.shift();)n()}),function(n){i?setTimeout(n,0):e.push(n)}})},{}],5:[function(n,e,t){"use strict";e.exports=function(i){var u={},a=[];(i=i||this).on=function(n,e,t){return(u[n]=u[n]||[]).push([e,t]),i},i.off=function(n,e){n||(u={});for(var t=u[n]||a,r=t.length=e?t.length:0;r--;)e==t[r][0]&&t.splice(r,1);return i},i.emit=function(n){for(var e,t=u[n]||a,r=0<t.length?t.slice(0,t.length):t,o=0;e=r[o++];)e[0].apply(e[1],a.slice.call(arguments,1));return i}}},{}],6:[function(n,e,t){"use strict";function j(n,e){return function(n){if(Array.isArray(n))return n}(n)||function(n,e){var t=[],r=!0,o=!1,i=void 0;try{for(var u,a=n[Symbol.iterator]();!(r=(u=a.next()).done)&&(t.push(u.value),!e||t.length!==e);r=!0);}catch(n){o=!0,i=n}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}return t}(n,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}var r=n("domready"),N=n("@tryghost/members-layer2");function W(n){n&&window.location.reload()}r(function(){var r=N({membersUrl:window.membersUrl}),n=j(window.location.hash.match(/^#([^?]+)\??(.*)$/)||[],3),e=n[0],t=n[1],o=n[2];if(e&&"reset-password"===t){var i=o.match(/token=([a-zA-Z0-9-_]+.[a-zA-Z0-9-_]+.[a-zA-Z0-9-_]+)/)||[],u=j(i,2),a=u[0],c=u[1];if(a)return r.resetPassword({token:c}).then(function(n){return window.location.hash="",n}).then(W)}var s=document.querySelectorAll("[data-members-signin]"),f=document.querySelectorAll("[data-members-signup]"),l=document.querySelectorAll("[data-members-upgrade]"),d=document.querySelectorAll("[data-members-signout]");function m(n){return fetch("/members/ssr",{method:"post",credentials:"include",body:n}).then(function(n){return!!n.ok})}function v(){return fetch("/members/ssr",{method:"delete"}).then(function(n){return!!n.ok})}r.on("signedin",function(){r.getSSRToken({fresh:!0}).then(function(n){m(n)})}),r.on("signedout",function(){v()});var h=!0,y=!1,p=void 0;try{for(var g,w=s[Symbol.iterator]();!(h=(g=w.next()).done);h=!0){var b=g.value;b.addEventListener("click",function(n){n.preventDefault(),r.signin().then(function(){return r.getSSRToken({fresh:!0}).then(function(n){return m(n)})}).then(W)})}}catch(n){y=!0,p=n}finally{try{h||null==w.return||w.return()}finally{if(y)throw p}}var k=!0,S=!1,x=void 0;try{for(var E,T=function(){var t=E.value;t.addEventListener("click",function(n){n.preventDefault();var e=t.dataset.membersCoupon;!function(n){var e=n.coupon,t=void 0===e?"":e;r.signup({coupon:t}).then(function(){return r.getSSRToken({fresh:!0}).then(function(n){return m(n)})}).then(W)}({coupon:e})})},L=f[Symbol.iterator]();!(k=(E=L.next()).done);k=!0)T()}catch(n){S=!0,x=n}finally{try{k||null==L.return||L.return()}finally{if(S)throw x}}var q=!0,A=!1,U=void 0;try{for(var C,P=l[Symbol.iterator]();!(q=(C=P.next()).done);q=!0){var D=C.value;D.addEventListener("click",function(n){n.preventDefault(),r.upgrade().then(function(){return r.getSSRToken({fresh:!0}).then(function(n){return m(n)})}).then(W)})}}catch(n){A=!0,U=n}finally{try{q||null==P.return||P.return()}finally{if(A)throw U}}var R=!0,O=!1,_=void 0;try{for(var z,M=d[Symbol.iterator]();!(R=(z=M.next()).done);R=!0){var Z=z.value;Z.addEventListener("click",function(n){n.preventDefault(),r.signout().then(function(){return v()}).then(W)})}}catch(n){O=!0,_=n}finally{try{R||null==M.return||M.return()}finally{if(O)throw _}}})},{"@tryghost/members-layer2":3,domready:4}]},{},[6]);
//# sourceMappingURL=members-theme-dropin.js.map